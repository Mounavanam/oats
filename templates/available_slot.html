{% extends "base_bootstrapped.html" %}

{% block content %}

    <article>
        <h1>AVAILABLE SLOTS</h1>

        <form method="GET" id="filter-form">
            <label for="course-select">Course:</label>
            <select name="course" id="course-select">
                <option value="">-- Select Course --</option>
                {% for course in courses %}
                    <option value="{{ course.id }}">{{ course.name }}</option>
                {% endfor %}
            </select>

            <label for="tutor-select">Tutor:</label>
            <select name="tutor" id="tutor-select">
                <option value="">-- Select Tutor --</option>
            </select>

            <input type="submit" value="Filter">
        </form>

        <table>
            <thead>
            <tr>
                <th>Tutor</th>
                <th>Course</th>
                <th>Date</th>
                <th>TIME BLOCK</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody id="slot-table">
            {% for slot in slots %}
                {% if slot.status == 'A' %}
                    <tr class="slot-row" data-course="{{ slot.course.id }}" data-tutor="{{ slot.tutor.id }}">
                        <td>{{ slot.tutor }}</td>
                        <td>{{ slot.course }}</td>
                        <td>{{ slot.date }}</td>
                        <td>{{ slot.timeblock }}</td>
                        <td>{{ slot.status }}</td>
                        <td><a href="{% url 'booking_page' slot.id %}">
                            <button>Book</button></a>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </article>

    <a href="{% url 'home' %}"><button>Back</button></a>

    <script>
        $(document).ready(function() {
            $('#filter-form').submit(function(event) {
                event.preventDefault();

                var course = $('#course-select').val();
                var tutor = $('#tutor-select').val();

                $('.slot-row').hide();

                if (course && tutor) {
                    $('.slot-row[data-course="' + course + '"][data-tutor="' + tutor + '"]').show();
                } else if (course) {
                    $('.slot-row[data-course="' + course + '"]').show();
                } else {
                    $('.slot-row').show();
                }
            });

            $('#course-select').change(function() {
                var course = $(this).val();

                $('#tutor-select').empty();

                if (course) {
                    $.ajax({
                        url: '/get_tutors/' + course,
                        success: function(data) {
                            $.each(data, function(key, value) {
                                $('#tutor-select').append($('<option></option>').attr('value', value.id).text(value.name));
                            });
                        }
                    });
                }
            });
        });
    </script>

{% endblock content %}
